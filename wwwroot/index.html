<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>People API</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { color-scheme: light dark; }
    /* Stylish layered gradient background */
    body{
      font-family:system-ui,Arial,sans-serif;margin:0;line-height:1.4;transition:background .5s,color .3s;
      min-height:100dvh;display:flex;flex-direction:column;align-items:center;
      background:
        radial-gradient(circle at 80% 20%, rgba(255,180,80,.35), transparent 55%),
        radial-gradient(circle at 15% 85%, rgba(95,180,255,.35), transparent 60%),
        radial-gradient(circle at 15% 20%, rgba(140,100,255,.35), transparent 55%),
        linear-gradient(135deg,#f8fafc,#eef5ff 30%,#f3f0ff 65%,#fdf7ef);
    }
    body.dark{
      background:
        radial-gradient(circle at 80% 25%, rgba(255,140,0,.18), transparent 55%),
        radial-gradient(circle at 18% 78%, rgba(0,170,255,.22), transparent 60%),
        radial-gradient(circle at 12% 18%, rgba(180,120,255,.25), transparent 55%),
        linear-gradient(135deg,#0f1116,#121823 35%,#161c29 70%,#1b1722);
    }
    /* Subtle animated glow layer */
    body::before{
      content:"";position:fixed;inset:0;pointer-events:none;z-index:-1;
      background:
        repeating-radial-gradient(circle at 50% 50%,rgba(255,255,255,0.08),rgba(255,255,255,0.08) 2px,transparent 2px,transparent 6px);
      mix-blend-mode:overlay;opacity:.35;animation:float 24s linear infinite;
    }
    body.dark::before{opacity:.18;mix-blend-mode:soft-light;}
    @keyframes float{0%{transform:translateY(0)}50%{transform:translateY(-18px) rotate(0.5deg)}100%{transform:translateY(0)}}

    main{width:100%;max-width:980px;padding:2.25rem 2rem 3rem;box-sizing:border-box;}
    h1{margin:0 0 1rem;font-size:clamp(1.9rem,3.5vw,2.6rem);display:flex;align-items:center;gap:.7rem;letter-spacing:.5px;background:linear-gradient(90deg,#30384a,#584b89,#965);
      -webkit-background-clip:text;color:#30384a}
    body.dark h1{background:linear-gradient(90deg,#d4e1ff,#b9a5ff,#ffcfb9);-webkit-background-clip:text;color:transparent}

    .status, .panel{backdrop-filter:blur(10px);padding:1.1rem 1.25rem;border:1px solid #d2d8e2;border-radius:18px;margin-bottom:1.15rem;background:linear-gradient(145deg,rgba(255,255,255,.78),rgba(255,255,255,.55));
      box-shadow:0 4px 12px -2px rgba(30,40,70,.15),0 1px 0 rgba(255,255,255,.6) inset}
    body.dark .status, body.dark .panel{background:linear-gradient(145deg,rgba(30,36,48,.78),rgba(28,32,44,.55));border-color:#2c3746;box-shadow:0 4px 14px -2px rgba(0,0,0,.55),0 1px 0 rgba(255,255,255,.05) inset}

    .flex{display:flex;gap:.6rem;flex-wrap:wrap;margin-bottom:1rem}
    button,input{font:inherit}
    button{cursor:pointer;padding:.6rem 1rem;border:1px solid #7c8594;border-radius:10px;background:linear-gradient(#f5f7fa,#e6eaef);letter-spacing:.3px;font-weight:500;transition:.25s}
    button:hover{background:linear-gradient(#ffffff,#e9edf3);transform:translateY(-2px);box-shadow:0 4px 10px -2px rgba(40,60,90,.25)}
    button:active{transform:translateY(0);box-shadow:none}
    body.dark button{background:linear-gradient(#2c3442,#202836);border-color:#3d4959;color:#e0e7ef}
    body.dark button:hover{background:linear-gradient(#364152,#2a3242);box-shadow:0 4px 10px -2px rgba(0,0,0,.55)}

    input{padding:.55rem .7rem;border:1px solid #a8b2c2;border-radius:9px;min-width:0;background:rgba(255,255,255,.85);backdrop-filter:blur(3px);}
    input:focus{outline:2px solid #6d83ff;outline-offset:1px}
    body.dark input{background:rgba(40,48,60,.82);border-color:#3f4957;color:#e6ecf3}

    form.add-person{display:flex;flex-wrap:wrap;gap:.65rem;align-items:flex-start}
    form.add-person > *{flex:1 1 160px}
    form.add-person button{flex:0 0 auto}
    .ok{color:#0d7c05;font-weight:600}
    .fail{color:#ff4d55;font-weight:600}
    code{background:#f4f4f4;padding:.2rem .45rem;border-radius:6px;font-size:.8rem}
    body.dark code{background:#2d3642}
    small{color:#556070}
    body.dark small{color:#7b8797}
    .mono{font-family:ui-monospace,Consolas,monospace}
    #peopleTable{width:100%;border-collapse:collapse;margin-top:.55rem;font-size:.9rem;overflow:hidden;border-radius:10px}
    #peopleTable th,#peopleTable td{border:1px solid #d0d6e2;padding:.55rem .7rem;text-align:left}
    #peopleTable th{background:#eef2f7;font-weight:600}
    tbody tr:nth-child(even){background:#f9fbfd}
    body.dark #peopleTable th{background:#2d3642;border-color:#3c4757}
    body.dark #peopleTable td{border-color:#3a4553}
    body.dark tbody tr:nth-child(even){background:#222b36}

    .dark body, body.dark{color:#e2e6eb}
    .tag{display:inline-block;background:#eef;border:1px solid #ccd;padding:.18rem .55rem;border-radius:30px;font-size:.65rem;text-transform:uppercase;letter-spacing:.7px;font-weight:600;color:#334;box-shadow:0 1px 2px rgba(0,0,0,.15)}
    body.dark .tag{background:#24324a;color:#c8d9f4;border-color:#3a4d68}
    footer{margin-top:2.2rem;font-size:.7rem;color:#5a6572;text-align:center}
    body.dark footer{color:#7d8896}
    a{color:#2b5dcc;text-decoration:none;font-weight:500}
    a:hover{text-decoration:underline}
    body.dark a{color:#6fa8ff}
    .inline-msg{font-size:.75rem;margin-left:.5rem;min-height:1.1rem;display:inline-flex;align-items:center}
    .glow-sep{height:1px;background:linear-gradient(90deg,transparent,#b9c6ff 35%,#ffcfae 70%,transparent);margin:1.6rem 0;opacity:.6}
  </style>
</head>
<body>
  <main>
  <h1>People API <span class="tag" id="envTag"></span></h1>
  <p style="margin-top:.2rem">Swagger UI: <a href="/swagger" target="_blank" rel="noopener">/swagger</a></p>

  <div class="flex">
    <button id="btnPing">Refresh Status</button>
    <button id="btnLoad">Load People</button>
    <button id="btnSeed">Seed Sample Data</button>
    <button id="btnDark">Toggle Dark Mode</button>
  </div>

  <section class="status">
    <h2 style="margin-top:0">Runtime Status</h2>
    <p id="check">Checking API...</p>
    <ul id="details" style="display:none"></ul>
    <small id="ts"></small>
  </section>

  <section class="panel">
    <h2 style="margin-top:0">People</h2>
    <table id="peopleTable" aria-describedby="peopleHeading">
      <thead>
        <tr><th>Id</th><th>First</th><th>Last</th><th>Age</th></tr>
      </thead>
      <tbody id="peopleBody"><tr><td colspan="4">(empty)</td></tr></tbody>
    </table>
  </section>

  <section class="panel">
    <h2 style="margin-top:0">Add Person</h2>
    <form id="addForm" class="add-person" autocomplete="off">
      <input id="firstName" name="firstName" placeholder="First name" required />
      <input id="lastName" name="lastName" placeholder="Last name" required />
      <input id="age" name="age" type="number" min="0" max="130" placeholder="Age" required />
      <button type="submit">Add</button>
      <span id="addMsg" class="inline-msg"></span>
    </form>
  </section>

  <div class="glow-sep"></div>

  <section class="panel">
    <h2 style="margin-top:0">Meta</h2>
    <pre id="meta" class="mono" style="margin:0;white-space:pre-wrap">Loading...</pre>
  </section>

  <footer>
    <span id="ver"></span> · <span id="year"></span> · SQLite backed minimal API demo
  </footer>
  </main>

<script>
  const checkEl = document.getElementById('check');
  const listEl = document.getElementById('details');
  const tsEl = document.getElementById('ts');
  const bodyEl = document.getElementById('peopleBody');
  const metaEl = document.getElementById('meta');
  const verEl = document.getElementById('ver');
  const envTag = document.getElementById('envTag');
  const yearEl = document.getElementById('year');
  const addForm = document.getElementById('addForm');
  const addMsg = document.getElementById('addMsg');
  yearEl.textContent = new Date().getFullYear();

  const darkPref = localStorage.getItem('darkMode');
  if (darkPref === '1' || (darkPref===null && window.matchMedia('(prefers-color-scheme: dark)').matches)) document.body.classList.add('dark');

  async function ping(){
    listEl.style.display='none';
    checkEl.textContent='Checking API...';
    tsEl.textContent='';
    const started = performance.now();
    try {
      const res = await fetch('/api/people',{cache:'no-store'});
      const ms = Math.round(performance.now()-started);
      if(!res.ok) throw new Error('HTTP '+res.status);
      const data = await res.json();
      checkEl.innerHTML = '<span class="ok">API is running</span>';
      listEl.innerHTML = ''+
        `<li>People count: <strong>${data.length}</strong></li>`+
        `<li>Response time: <strong>${ms} ms</strong></li>`+
        `<li>Endpoint: <code>/api/people</code></li>`;
      listEl.style.display='block';
    } catch(err){
      checkEl.innerHTML = '<span class="fail">API check failed</span>: '+err.message;
    } finally {
      tsEl.textContent='Last updated: '+ new Date().toLocaleString();
    }
  }

  async function loadPeople(){
    bodyEl.innerHTML = '<tr><td colspan="4">Loading...</td></tr>';
    try {
      const res = await fetch('/api/people');
      if(!res.ok) throw new Error('HTTP '+res.status);
      const data = await res.json();
      if(!data.length){
        bodyEl.innerHTML = '<tr><td colspan="4">No people yet</td></tr>';
        return;
      }
      bodyEl.innerHTML = data.map(p => `<tr><td>${p.id}</td><td>${p.firstName}</td><td>${p.lastName}</td><td>${p.age}</td></tr>`).join('');
    } catch(err){
      bodyEl.innerHTML = `<tr><td colspan="4">Error: ${err.message}</td></tr>`;
    }
  }

  async function loadMeta(){
    try{
      const res = await fetch('/api/meta');
      if(!res.ok) throw new Error('HTTP '+res.status);
      const m = await res.json();
      metaEl.textContent = JSON.stringify(m,null,2);
      verEl.textContent = 'Version: '+ (m.version||'?');
      envTag.textContent = m.environment || 'Env';
    }catch(err){
      metaEl.textContent = 'Meta load failed: '+err.message;
    }
  }

  async function seed(){
    try {
      const res = await fetch('/api/people/seed', { method:'POST'});
      if(!res.ok) throw new Error('HTTP '+res.status);
      const r = await res.json();
      await Promise.all([ping(), loadPeople()]);
      alert('Seed complete. Added: '+r.added+' Total: '+r.total+(r.skipped?' (skipped existing)':''));
    } catch(err) {
      alert('Seed failed: '+err.message);
    }
  }

  async function addPerson(e){
    e.preventDefault();
    addMsg.textContent='Saving...';
    addMsg.className='inline-msg';
    const formData = new FormData(addForm);
    const payload = {
      firstName: formData.get('firstName')?.trim(),
      lastName: formData.get('lastName')?.trim(),
      age: Number(formData.get('age'))
    };
    if(!payload.firstName || !payload.lastName || isNaN(payload.age)){
      addMsg.textContent='Invalid input';
      addMsg.classList.add('fail');
      return;
    }
    try{
      const res = await fetch('/api/people', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      if(!res.ok) throw new Error('HTTP '+res.status);
      addMsg.textContent='Added';
      addMsg.classList.add('ok');
      addForm.reset();
      await loadPeople();
      await ping();
    }catch(err){
      addMsg.textContent='Error: '+err.message;
      addMsg.classList.add('fail');
    }
  }

  function toggleDark(){
    document.body.classList.toggle('dark');
    localStorage.setItem('darkMode', document.body.classList.contains('dark') ? '1':'0');
  }

  document.getElementById('btnPing').onclick = ping;
  document.getElementById('btnLoad').onclick = () => { loadPeople(); ping(); };
  document.getElementById('btnSeed').onclick = seed;
  document.getElementById('btnDark').onclick = toggleDark;
  addForm.addEventListener('submit', addPerson);

  ping();
  loadPeople();
  loadMeta();
</script>
</body>
</html>