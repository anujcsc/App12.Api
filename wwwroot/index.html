<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>People API</title>
  <style>
    body{font-family:system-ui,Arial,sans-serif;margin:2rem;line-height:1.4}
    h1{margin-top:0}
    .status{padding:1rem;border:1px solid #ddd;border-radius:6px;max-width:520px}
    .ok{color:#0a7500;font-weight:600}
    .fail{color:#b00020;font-weight:600}
    code{background:#f4f4f4;padding:.15rem .35rem;border-radius:4px;font-size:.9rem}
    small{color:#666}
  </style>
</head>
<body>
  <h1>People API (VB)</h1>
  <p>Swagger UI: <a href="/swagger" target="_blank" rel="noopener">/swagger</a></p>

  <section class="status">
    <h2 style="margin-top:0">Runtime Status</h2>
    <p id="check">Checking API...</p>
    <ul id="details" style="display:none"></ul>
    <button id="retry" style="display:none">Retry</button>
    <small id="ts"></small>
  </section>

  <script>
    const checkEl = document.getElementById('check');
    const listEl = document.getElementById('details');
    const retryBtn = document.getElementById('retry');
    const tsEl = document.getElementById('ts');

    async function ping(){
      retryBtn.style.display='none';
      listEl.style.display='none';
      checkEl.textContent='Checking API...';
      tsEl.textContent='';
      const started = performance.now();
      try {
        const res = await fetch('/api/people',{cache:'no-store'});
        const ms = Math.round(performance.now()-started);
        if(!res.ok) throw new Error('HTTP '+res.status);
        const data = await res.json();
        checkEl.innerHTML = '<span class="ok">API is running</span>';        
        listEl.innerHTML = ''+
          `<li>People count: <strong>${data.length}</strong></li>`+
          `<li>Response time: <strong>${ms} ms</strong></li>`+
          `<li>Endpoint: <code>/api/people</code></li>`;
        listEl.style.display='block';
      } catch(err){
        checkEl.innerHTML = '<span class="fail">API check failed</span>: '+err.message;
        retryBtn.style.display='inline-block';
      } finally {
        tsEl.textContent='Last updated: '+ new Date().toLocaleString();
      }
    }

    retryBtn.addEventListener('click', ping);
    ping();
  </script>
</body>
</html>